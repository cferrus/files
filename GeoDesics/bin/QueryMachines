#!/usr/bin/env perl
use strict;
use warnings FATAL => 'all';
use vars qw($ME $Machine);
use Cwd;
use File::Basename;
# Load SpEC perl modules
use lib dirname(Cwd::abs_path(__FILE__));
use Utils;
use Machines;

#--------------\
# Help message  >
#--------------/
sub Help {
  print STDERR <<"EoF";
Provides an interface to the public member functions of Machines.pm.
Usage: $ME Command option1 option2 ...

REQUIRED OPTIONS:
  Command       Member function of Machines.pm to call.
OPTIONS:
  All options are passed to the corresponding member function as is. For
  key-value type options first pass the name of the key then the value eg.
  GetResubCmd WorkDir Foo.
EoF
  exit(1);
}
$ME = basename(__FILE__);
$Machine = new Machines();

if($#ARGV == -1 or $ARGV[0] eq '-h') {
  Help();
}

Main();
exit 0;

sub Main {
  my $cmd = shift @ARGV;
  if (defined &{"Machines::$cmd"}) {
    print $Machine->$cmd(@ARGV),"\n";
  } else {
    print "Unknown machine query '$cmd'. Possible queries are:\n";
    ShowMachinesMethods();
    exit 1;
  }
}

sub ShowMachinesMethods {
  no strict 'refs';
  # All the methods in Machines' symbol table
  my @methods = grep { defined &{"Machines::$_"} and not m/^_/ }
                     keys %Machines::;
  use strict 'refs';
  print (join(" ",@methods),"\n");
}
