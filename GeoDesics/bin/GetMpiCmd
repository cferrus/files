#!/usr/bin/env perl
use strict;
use warnings FATAL => 'all';
use Getopt::Std;
use vars qw($ME $opt_h $opt_v $opt_p);
use Cwd;
use File::Basename;
# Load SpEC perl modules
use lib dirname(Cwd::abs_path(__FILE__));
use Utils;
use Machines;

#--------------\
# Help message  >
#--------------/
sub Help {
  print STDERR <<"EoF";
Returns the appropriate mpirun-like command for the current machine.
Usage: $ME [options]

REQUIRED OPTIONS:
  -p NUM        Number of processors (i.e. cores) to use with mpi.
OPTIONS:
  -h            Help. Print this table.
  -v            Verbose.
EoF
  exit(1);
}
$ME = basename(__FILE__);

getopts('hvp:') || Help(); Help() if $opt_h;
unless (defined($opt_p) and $opt_p =~ /^\s*\d+\s*$/ and $opt_p>0) {
  warn "$ME: -p option must be a positive integer\n"; Help();
}

Main();
exit 0;

sub Main {
  my $Machine = new Machines();
  my $host = $Machine->GetHost();
  print STDERR "$ME: Host = $host\n" if ($opt_v);
  print $Machine->GetMpiCmd($opt_p);
}
