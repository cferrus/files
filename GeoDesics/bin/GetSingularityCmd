#!/usr/bin/env perl
use strict;
use warnings FATAL => 'all';
use Getopt::Std;
use vars qw($ME $opt_h $opt_v $opt_i);
use Cwd;
use File::Basename;
# Load SpEC perl modules
use lib dirname(Cwd::abs_path(__FILE__));
use Utils;
use Machines;

#--------------\
# Help message  >
#--------------/
sub Help {
  print STDERR <<"EoF";
Returns the appropriate Singularity command for the current machine.
Usage: $ME [options]

OPTIONS:
  -i            If already inside a container, returns nothing.
  -h            Help. Print this table.
  -v            Verbose.
EoF
  exit(1);
}
$ME = basename(__FILE__);

getopts('hvi') || Help(); Help() if $opt_h;

Main();
exit 0;

sub Main {
  my $Machine = new Machines();
  my $host = $Machine->GetHost();
  print STDERR "$ME: Host = $host\n" if ($opt_v);
  if($opt_i) {
    print $Machine->GetSingularityCmdIfNeeded();
  } else {
    print $Machine->GetSingularityCmd();
  }
}
